{% extends "layout/base_dashboard.html" %}
{% load static %}

{% block title %}Estudiantes{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'estudiantes/css/lista_estudiantes.css' %}">
{% endblock %}

{% block content %}
  <div class="dashboard-header">
    <h2 class="hdr-sub">
      Estudiantes
    </h2>
    <p>Listado de los estudiantes habilitados.</p>
  </div>
<form method="get" class="form-estudiantes">
  <input type="text" name="q" value="{{ request.GET.q }}" placeholder="Buscar por nombre, CI o curso" class="input-busqueda">
  <button type="submit" class="btn-buscar">Buscar</button>
  <a href="{% url 'estudiantes:crear' %}" class="btn-nuevo">Nuevo estudiante</a>
</form>

<div class="table-wrapper">
  <table class="tabla">
    <thead>
      <tr>
        <th>#</th>
        <th>Apellidos</th>
        <th>Nombres</th>
        <th>CI</th>
        <th>Curso</th>
        <th>Padre/Tutor</th>
        <th>Kardex</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for e in object_list %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ e.apellidos }}</td>
        <td>{{ e.nombres }}</td>
        <td>{{ e.ci }}</td>
        <td>{{ e.curso }}</td>
        <td>{{ e.padre }}</td>
        <td>{% if e.kardex_id %}Asignado{% else %}-{% endif %}</td>
        <td>
          {% if "secretaria" in role or "secretaría" in role %}
            {# Secretaría: solo puede editar #}
            <a href="{% url 'estudiantes:editar' e.pk %}">Editar</a>
          {% else %}
            {# Director / otros roles: todo como antes #}
            <a href="{% url 'estudiantes:editar' e.pk %}">Editar</a>
            <a href="{% url 'estudiantes:eliminar' e.pk %}">Eliminar</a>
            <a href="{% url 'estudiantes:kardex_listar' e.pk %}" class="btn-kardex">Ver Kárdex</a>
            <a href="{% url 'estudiantes:kardex_nuevo' e.pk %}" class="btn-registro">Registro</a>
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="8">Sin registros.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
