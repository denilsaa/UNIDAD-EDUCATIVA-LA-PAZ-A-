{% extends "layout/base_dashboard.html" %}
{% load static %}

{% block title %}Historial de acciones sobre estudiantes{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'auditoria/css/historial_estudiantes.css' %}">
{% endblock %}

{% block content %}

  <!-- HERO / BANNER (como Usuarios) -->
  <section class="audit-hero">
    <h1 class="audit-hero-title">Historial de acciones sobre estudiantes</h1>
    <p class="audit-hero-subtitle">
      Aquí puedes ver quién creó, modificó o eliminó estudiantes, con fecha, hora, IP y navegador.
    </p>
  </section>

  <!-- CARD CONTENIDO -->
  <section class="audit-panel">
    <!-- FILTROS -->
    <div class="audit-toolbar">
      <div class="audit-search">
        <label for="audit-search" class="audit-label">Buscar</label>
        <input
          id="audit-search"
          type="text"
          class="audit-input"
          placeholder="Filtrar por usuario, estudiante, descripción, IP o navegador..."
          value="{{ q }}"
          data-server-value="{{ q }}"
        >
      </div>

      <div class="audit-actions">
        <button id="audit-clear" type="button" class="audit-btn audit-btn-secondary">Limpiar</button>
      </div>
    </div>

    <!-- TABLA -->
    <div class="audit-table-wrapper">
      <table class="audit-table" id="audit-table">
        <thead>
          <tr>
            <th>Fecha y hora</th>
            <th>Usuario</th>
            <th>Acción</th>
            <th>Estudiante</th>
            <th>Descripción</th>
            <th>IP</th>
            <th>Navegador</th>
          </tr>
        </thead>

        <tbody>
          {% for log in logs %}
            <tr>
              <td data-label="Fecha y hora" class="audit-col-date">{{ log.creado_en }}</td>

              <td data-label="Usuario">
                {% if log.usuario %}
                  <span class="audit-strong">{{ log.usuario }}</span>
                {% else %}
                  <span class="audit-muted">—</span>
                {% endif %}
              </td>

              <td data-label="Acción">
                <span class="audit-badge audit-badge-{{ log.accion|lower }}">
                  {{ log.get_accion_display }}
                </span>
              </td>

              <td data-label="Estudiante">
                {% if log.estudiante %}
                  {{ log.estudiante }}
                {% elif log.estudiante_nombre %}
                  {{ log.estudiante_nombre }}
                {% else %}
                  <span class="audit-muted">—</span>
                {% endif %}
              </td>

              <td data-label="Descripción" class="audit-col-desc">
                {{ log.descripcion }}
              </td>

              <td data-label="IP">
                <span class="audit-mono">{{ log.ip|default:"—" }}</span>
              </td>

              <td data-label="Navegador" class="audit-ua" title="{{ log.user_agent }}">
                {{ log.user_agent }}
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="7" class="audit-empty">
                No hay registros aún.
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <p class="audit-note">
      Mostrando hasta 500 registros más recientes.
    </p>
  </section>

<script src="{% static 'auditoria/js/historial_estudiantes.js' %}"></script>
{% endblock %}
