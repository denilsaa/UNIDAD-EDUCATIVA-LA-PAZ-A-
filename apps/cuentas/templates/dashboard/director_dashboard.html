{% extends "layout/base_dashboard.html" %}
{% load static %}

{% block title %}Dashboard del Director{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'cuentas/css/dashboard_director.css' %}">
{% endblock %}

{% block content %}
  <!-- === ENCABEZADO === -->
  <div class="dashboard-header">
    <h2 class="hdr-sub">
      {% if "director" in role %}Panel del Director
      {% elif "regente" in role %}Panel del Regente
      {% elif "secretaria" in role or "secretaría" in role %}Panel de Secretaría
      {% elif "padre" in role %}Panel de Padre de familia
      {% else %}Panel{% endif %}
    </h2>
    <p>Resumen general de asistencia, comportamiento y roles</p>
  </div>
  <!-- === SECCIÓN: KPIs Y GRÁFICAS REORDENADAS === -->
  <section class="dashboard-main-grid">

    <!-- === COLUMNA IZQUIERDA === -->
    <div class="column left-column">
      <!-- Fila superior (60%) -->
      <div class="row top-row">
        <div class="chart-card large-card">
          <div class="chart-container">
            <div class="chart-header">
              <h4>Asistencia hoy</h4>
            </div>
            <div class="chart-body kpi-chart-body">
              <div class="kpi-canvas-wrapper">
                <canvas id="asistenciaHoyChart"></canvas>
                <div class="kpi-value">{{ asistencia_hoy|default:0 }}%</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Fila inferior (40%) -->
      <div class="row bottom-row">
        <div class="chart-card">
          <div class="chart-container">
            <div class="chart-header">
              <h4>Asistencia por mes</h4>
            </div>
            <div class="chart-body">
              <canvas id="asistenciaMeses"></canvas>
            </div>
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-container">
            <div class="chart-header">
              <h4>Kárdex negativo por área</h4>
            </div>
            <div class="chart-body">
              <canvas id="kardexArea"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- === COLUMNA DERECHA === -->
    <div class="column right-column">
      <!-- Fila superior (40%) -->
      <div class="row top-row">
        <div class="chart-card">
          <div class="chart-container">
            <div class="chart-header">
              <h4>Kárdex negativo (7 días)</h4>
            </div>
            <div class="chart-body">
              <canvas id="negativosSemana"></canvas>
            </div>
          </div>
        </div>
      </div>
      <!-- Fila inferior (60%) -->
      <div class="row bottom-row">
        <div class="chart-card">
          <div class="chart-container">
            <div class="chart-header">
              <h4>Usuarios por rol</h4>
            </div>
            <div class="chart-body pie-chart-body">
              <canvas id="rolesPie"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

  </section>
<br><br><br>

<!-- === DATOS DE CHART.JS === -->
{{ asistencia_por_mes|json_script:"asistencia-por-mes" }}
{{ negativos_por_area|json_script:"negativos-por-area" }}
{{ negativos_semana|json_script:"negativos-semana" }}
{{ roles_counts|json_script:"roles_counts" }}
{{ asistencia_hoy|json_script:"asistencia-hoy" }}

<!-- === CHART.JS === -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
{% block extra_js %}
  {{ block.super }}
  <script src="{% static 'cuentas/js/dashboard_director.js' %}"></script>
{% endblock %}
<!-- Footer -->
<footer class="ftr">
    <small>© {% now "Y" %} Unidad Educativa La Paz “A”.</small>
  </footer>
{% endblock %}

