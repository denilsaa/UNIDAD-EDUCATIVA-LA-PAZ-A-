{% extends "layout/base_dashboard.html" %}
{% load static %}

{% block title %}Dashboard de Secretaría{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'cuentas/css/dashboard_director.css' %}">
{% endblock %}

{% block content %}
  <div class="dashboard-header">
    <h2 class="hdr-sub">Panel de Secretaría</h2>
    <p>Resumen de estudiantes, cursos y citaciones.</p>
  </div>

  <section class="dashboard-main-grid">
    <!-- COLUMNA IZQUIERDA -->
    <div class="column left-column">
      <div class="row top-row">
        <div class="chart-card large-card">
          <div class="chart-container">
            <div class="chart-header">
              <h4>Citaciones por estado</h4>
            </div>
            <div class="chart-body pie-chart-body">
              <canvas id="secCitacionesEstadoChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="row bottom-row">
        <div class="chart-card">
          <div class="chart-container">
            <div class="chart-header">
              <h4>Estudiantes por curso (Top 10)</h4>
            </div>
            <div class="chart-body">
              <canvas id="secEstudiantesCursoChart"></canvas>
            </div>
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-container">
            <div class="chart-header">
              <h4>Altas de estudiantes por mes</h4>
            </div>
            <div class="chart-body">
              <canvas id="secAltasEstudiantesChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- COLUMNA DERECHA -->
    <div class="column right-column">
      <div class="row top-row">
        <div class="chart-card">
          <div class="chart-container">
            <div class="chart-header">
              <h4>Resumen rápido</h4>
            </div>
            <div class="chart-body kpi-list">
              <p><strong>Estudiantes:</strong> {{ total_estudiantes }}</p>
              <p><strong>Cursos:</strong> {{ total_cursos }}</p>
              <p><strong>Padres registrados:</strong> {{ total_padres }}</p>
              <p><strong>Citaciones pendientes:</strong> {{ cit_pendientes }}</p>
              <p><strong>Citaciones agendadas:</strong> {{ cit_agendadas }}</p>
            </div>
          </div>
        </div>
      </div>

      <div class="row bottom-row">
        <div class="chart-card">
          <div class="chart-container">
            <div class="chart-header">
              <h4>Citaciones por mes (abiertas vs cerradas)</h4>
            </div>
            <div class="chart-body">
              <canvas id="secCitacionesMesChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  {# ==== JSON para Chart.js ==== #}
  {{ sec_citaciones_estado|json_script:"sec-citaciones-estado" }}
  {{ sec_estudiantes_curso|json_script:"sec-estudiantes-curso" }}
  {{ sec_altas_estudiantes|json_script:"sec-altas-estudiantes" }}
  {{ sec_citaciones_mes|json_script:"sec-citaciones-mes" }}

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  {% block extra_js %}
    {{ block.super }}
    <script src="{% static 'cuentas/js/dashboard_secretaria.js' %}"></script>
  {% endblock %}
{% endblock %}
