{% extends "layout/base_dashboard.html" %}
{% load static %}

{% block title %}Dashboard de Padre de familia{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'cuentas/css/dashboard_director.css' %}">
{% endblock %}

{% block content %}
  <div class="dashboard-header">
    <h2 class="hdr-sub">Panel de Padre de familia</h2>
    <p>Resumen de asistencia y citaciones de tus hijos.</p>
  </div>

  <section class="dashboard-main-grid">
    <!-- COLUMNA IZQUIERDA -->
    <div class="column left-column">
      <!-- Asistencia del mes -->
      <div class="row top-row">
        <div class="chart-card large-card">
          <div class="chart-container">
            <div class="chart-header">
              <h4>Asistencia del mes (tus hijos)</h4>
            </div>
            <div class="chart-body kpi-chart-body">
              <div class="kpi-canvas-wrapper">
                <canvas id="padAsistenciaMesChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Evolución + faltas por hijo -->
      <div class="row bottom-row">
        <div class="chart-card">
          <div class="chart-container">
            <div class="chart-header">
              <h4>Evolución de asistencia (últimos 6 meses)</h4>
            </div>
            <div class="chart-body">
              <canvas id="padAsistenciaMesesChart"></canvas>
            </div>
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-container">
            <div class="chart-header">
              <h4>Faltas y atrasos por hijo (90 días)</h4>
            </div>
            <div class="chart-body">
              <canvas id="padFaltasHijoChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- COLUMNA DERECHA -->
    <div class="column right-column">
      <div class="row top-row">
        <div class="chart-card">
          <div class="chart-container">
            <div class="chart-header">
              <h4>Resumen rápido</h4>
            </div>
            <div class="chart-body kpi-list">
              <p><strong>Hijos registrados:</strong> {{ total_hijos }}</p>
              <p><strong>Citaciones totales:</strong> {{ total_citaciones }}</p>
              <p><strong>Faltas acumuladas:</strong> {{ total_faltas }}</p>
              <p><strong>Atrasos acumulados:</strong> {{ total_atrasos }}</p>
            </div>
          </div>
        </div>
      </div>

      <div class="row bottom-row">
        <div class="chart-card">
          <div class="chart-container">
            <div class="chart-header">
              <h4>Últimas citaciones</h4>
            </div>
            <div class="chart-body table-body">
              {% if ultimas_citaciones %}
                <table class="tabla-mini">
                  <thead>
                    <tr>
                      <th>Fecha</th>
                      <th>Estudiante</th>
                      <th>Motivo</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for c in ultimas_citaciones %}
                    <tr>
                      <td>{{ c.fecha_citacion|date:"d/m/Y" }}</td>
                      <td>{{ c.estudiante }}</td>
                      <td>{{ c.motivo_resumen }}</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              {% else %}
                <p class="texto-vacio">No hay citaciones registradas.</p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  {# ==== JSON para Chart.js ==== #}
  {{ pad_asistencia_mes|json_script:"pad-asistencia-mes" }}
  {{ pad_asistencia_meses|json_script:"pad-asistencia-meses" }}
  {{ pad_faltas_hijo|json_script:"pad-faltas-hijo" }}

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  {% block extra_js %}
    {{ block.super }}
    <script src="{% static 'cuentas/js/dashboard_padre.js' %}"></script>
  {% endblock %}
{% endblock %}
