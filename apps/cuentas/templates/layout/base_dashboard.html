{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}Panel{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'cuentas/css/dashboard.css' %}">
  {% block extra_css %}{% endblock %}
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
</head>

{# Normalizamos el nombre del rol a minÃºsculas y manejamos None #}
{% with role=request.user.rol.nombre|default_if_none:""|default:""|lower %}
<body class="layout">

  <!-- Header -->
  <header class="hdr">
    <div class="hdr-left">
      <h1 class="hdr-title">Unidad Educativa La Paz â€œAâ€</h1>
      <span class="hdr-sub">
        {% if "director" in role %}Dashboard del Director
        {% elif "regente" in role %}Dashboard del Regente
        {% elif "secretaria" in role or "secretarÃ­a" in role %}Dashboard de SecretarÃ­a
        {% elif "padre" in role %}Dashboard de Padre de familia
        {% else %}Panel{% endif %}
      </span>
    </div>
    <!-- BOTÃ“N DEL MENU MÃ“VIL -->
    <span class="menu-toggle" onclick="toggleSidebar()">â˜°</span>
    <nav class="hdr-nav">
      {% if "director" in role %}
        <a href="{% url 'cuentas:director_dashboard' %}">Inicio</a>
        <a href="{% url 'estudiantes:listar' %}">Estudiantes</a>

      {% elif "regente" in role %}
        <a href="{% url 'cuentas:regente_dashboard' %}">Inicio</a>
        <a href="{% url 'cursos:mis_cursos_regente' %}">Mis cursos</a>

      {% elif "secretaria" in role or "secretarÃ­a" in role %}
        <a href="{% url 'cuentas:secretaria_dashboard' %}">Inicio</a>
        <a href="{% url 'estudiantes:listar' %}">Estudiantes</a>

      {% elif "padre" in role %}
        <a href="{% url 'cuentas:padre_dashboard' %}">Inicio</a>
        <a href="{% url 'estudiantes:mis_hijos' %}">Mis hijos</a>
      {% endif %}
      <a href="{% url 'cuentas:logout' %}">Cerrar sesiÃ³n</a>
    </nav>
  </header>

  <div class="wrap">
    <!-- Sidebar -->
    <aside class="sidenav">
      <nav>
        <h2 class="sidenav-title">Secciones</h2>
        <ul class="sidenav-list">

          {# --- Director --- #}
          {% if "director" in role %}
            <li><a href="{% url 'cuentas:director_dashboard' %}">ğŸ“Š Resumen</a></li>
            <li><a href="{% url 'cuentas:lista_usuarios' %}">ğŸ‘¤ Usuarios</a></li>
            <li><a href="{% url 'cursos:lista_cursos' %}">ğŸ“š Cursos</a></li>
            <li><a href="{% url 'cuentas:crear_usuario' %}">â• Nuevo usuario</a></li>
            <li><a href="{% url 'cursos:crear_curso' %}">â• Nuevo curso</a></li>
            <li><a href="{% url 'estudiantes:kardex_items_listar' %}">ğŸ—‚ï¸ CatÃ¡logo KÃ¡rdex</a></li>
            <li class="sep"></li>
            <li><a href="{% url 'estudiantes:listar' %}">ğŸ‘¥ Estudiantes</a></li>
            <li><a href="{% url 'estudiantes:crear' %}">â• Nuevo estudiante</a></li>

          {# --- Regente --- #}
          {% elif "regente" in role %}
            <li><a href="{% url 'cuentas:regente_dashboard' %}">ğŸ“Š Resumen</a></li>
            <li><a href="{% url 'cursos:mis_cursos_regente' %}">ğŸ“š Mis cursos</a></li>
            {# El CRUD global y el listado general de cursos NO se muestran al regente #}

          {# --- SecretarÃ­a --- #}
          {% elif "secretaria" in role or "secretarÃ­a" in role %}
            <li><a href="{% url 'cuentas:secretaria_dashboard' %}">ğŸ“Š Resumen</a></li>
            <li><a href="{% url 'cuentas:lista_usuarios' %}">ğŸ“„ Usuarios</a></li>
            <li class="sep"></li>
            <li><a href="{% url 'estudiantes:listar' %}">ğŸ‘¥ Estudiantes</a></li>
            <li><a href="{% url 'estudiantes:crear' %}">â• Nuevo estudiante</a></li>
            <li><a href="{% url 'estudiantes:kardex_items_listar' %}">ğŸ—‚ï¸ CatÃ¡logo KÃ¡rdex</a></li>

          {# --- Padre de familia --- #}
          {% elif "padre" in role %}
            <li><a href="{% url 'cuentas:padre_dashboard' %}">ğŸ  Inicio</a></li>
            <li><a href="{% url 'estudiantes:mis_hijos' %}">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Mis hijos</a></li>
            {# Dentro de â€œMis hijosâ€ podrÃ¡ entrar a Ver KÃ¡rdex; no se muestra CRUD alguno #}
          {% endif %}

          <li class="sep"></li>
          <li><a href="{% url 'cuentas:logout' %}">ğŸšª Cerrar sesiÃ³n</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Contenido -->
    <main class="main">
      {% if messages %}
        <div class="msgs">
          {% for message in messages %}
            <div class="msg msg-{{ message.tags }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}

      {% block content %}{% endblock %}
    </main>
  </div>

  <!-- Footer -->
  <footer class="ftr">
    <small>Â© {% now "Y" %} Unidad Educativa La Paz â€œAâ€.</small>
  </footer>
<script>
function toggleSidebar() {
  const sidenav = document.querySelector('.sidenav');
  sidenav.classList.toggle('open');
}
</script>

</body>
{% endwith %}
</html>
